openapi: 3.0.0
info:
  title: Heart Link
  version: 1.0.0
  description: This is a REST API application made with Express
  license:
    name: Licensed Under MIT
    url: "https://spdx.org/licenses/MIT.html"
  contact:
    name: Maverick Bits
    url: "https://jsonplaceholder.typicode.com"

paths:

  # User Controller

  /user/createUser:
    post:
      description: Create a new user if the email does not already exist.
      tags:
        - User Controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: "example@gmail.com"
      responses:
        201:
          description: User created successfully.
          content:
            application/json:
              schema:
                type: object

        400:
          description: Email missing in request.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Email is missing"
        409:
          description: User with the provided email already exists.
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  email:
                    type: string
        500:
          description: Internal server error while creating user.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Failed to create user"
                  details:
                    type: string
                    example: "Error message"

  /user/createProfile:
    post:
      description: Create or update a user profile with details and profile image.
      tags:
        - User Controller
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: "example@gmail.com"
                username:
                  type: string
                  example: "abhinav123"
                name:
                  type: string
                  example: "Abhinav Mahalwal"
                gender:
                  type: string
                  example: "Male"
                image:
                  type: string
                  format: binary
      responses:
        200:
          description: Profile created/updated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
        404:
          description: User with provided email does not exist.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "User with email does not exist"
        500:
          description: Server error while creating profile.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Failed to create profile"
                  details:
                    type: string
                    example: "Error message"

  /user/profile/{id}:
    get:
      description: Get user details by ID including signed profile image URL.
      tags:
        - User Controller
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: Unique user ID
      responses:
        200:
          description: User details retrieved successfully.
          content:
            application/json:
              schema:
                type: object
        404:
          description: User not found.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "User not found"
        500:
          description: Server error while fetching user.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Failed to fetch user"
                  details:
                    type: string
                    example: "Error message"

  /user/verifyUsername/{username}:
    post:
      description: Verify if a username is available for registration.
      tags:
        - User Controller
      parameters:
        - in: path
          name: username
          required: true
          schema:
            type: string
          description: Username to verify
      responses:
        200:
          description: Username is available.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Username available"
        400:
          description: Username not provided.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Username not present"
        409:
          description: Username already taken.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Username is taken"
        500:
          description: Internal server error while verifying username.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Failed to verify username"
                  details:
                    type: string
                    example: "Error message"

  /user/profileByCode:
    post:
      description: Get all users belonging to a specific room code.
      tags:
        - User Controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  example: "48291"
      responses:
        200:
          description: Users retrieved successfully for the given code.

        404:
          description: No users or room found for the provided code.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Room not found"
        500:
          description: Server error while fetching users by code.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Unable to leave room"
                  error:
                    type: string
                    example: "Error message"

  /push/saveToken:
    post:
      description: Save or update a user's FCM token
      tags:
        - FCM
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - token
              properties:
                userId:
                  type: integer
                  example: 1
                token:
                  type: string
                  example: "e1Zo7A1LSbiD8nBjaoWdvo:APA91bE8PSM3OivGAW..."
      responses:
        '200':
          description: Token saved or updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Token saved"
        '400':
          description: Missing userId or token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "UserId and Token are required"
        '500':
          description: Internal server error while saving token
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Internal server error"


  # Room Controller

  /room/generateCode:
    get:
      description: Generate a unique random room code that does not already exist.
      tags:
        - Room Controller
      responses:
        200:
          description: Code generated successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  code:
                    type: string
                    example: "48291"
        500:
          description: Server error while generating code.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Unable to generate code"
                  error:
                    type: string
                    example: "Error message"

  /room/leaveRoom:
    post:
      description: Delete an existing room and remove the code from both users.
      tags:
        - Room Controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  example: "48291"
      responses:
        200:
          description: Room deleted successfully and users updated.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Room deleted successfully"
        404:
          description: Room not found for the provided code.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Room not found"
        500:
          description: Server error while leaving room.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Unable to leave room"
                  error:
                    type: string
                    example: "Error message"

  # Mood Controller

  /mood/all:
    post:
      description: Retrieve all past moods for a given room code.
      tags:
        - Mood Controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  example: "48291"
      responses:
        200:
          description: Past moods retrieved successfully.

        404:
          description: Room not found or no moods exist for the given code.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "No room found for given code"
        500:
          description: Internal server error while fetching moods.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Failed to fetch past moods"
                  error:
                    type: string
                    example: "Error message"

  /mood/send:
    post:
      description: Send a mood and notify the receiver
      tags:
        - Mood Controller
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - moodId
                - senderId
                - receiverId
              properties:
                moodId:
                  type: string
                  example: "2"
                senderId:
                  type: integer
                  example: 1
                receiverId:
                  type: integer
                  example: 2
      responses:
        '200':
          description: Mood saved, with notification status
          content:
            application/json:
              schema:
                type: object
                properties:
                  moodSaved:
                    type: boolean
                    example: true
                  notificationSent:
                    type: boolean
                    example: true
                  errorReasonMood:
                    type: string
                    nullable: true
                    example: null
                  errorReasonNotification:
                    type: string
                    nullable: true
                    example: null
                  mood:
                    type: object
                    description: Saved mood document
                    properties:
                      id:
                        type: integer
                        example: 5
                      senderId:
                        type: integer
                        example: 1
                      receiverId:
                        type: integer
                        example: 2
                      moodId:
                        type: string
                        example: "2"
                      code:
                        type: string
                        example: "ABCD1234"
                      timestamp:
                        type: string
                        format: date-time
                        example: "2025-11-20T10:15:30.000Z"
        '404':
          description: Sender & receiver same OR room code not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  moodSaved:
                    type: boolean
                    example: false
                  notificationSent:
                    type: boolean
                    example: false
                  errorReasonMood:
                    type: string
                    example: "Could not find room code"
                  errorReasonNotification:
                    type: string
                    nullable: true
                    example: null
        '500':
          description: Failed to save mood
          content:
            application/json:
              schema:
                type: object
                properties:
                  moodSaved:
                    type: boolean
                    example: false
                  notificationSent:
                    type: boolean
                    example: false
                  errorReasonMood:
                    type: string
                    example: "Failed to save mood"
                  errorReasonNotification:
                    type: string
                    nullable: true
                    example: null

  /mood/last/{id}:
    get:
      description: Get last moods where user is sender or receiver
      tags:
        - Mood Controller
      parameters:
        - name: id
          in: path
          required: true
          description: User ID
          schema:
            type: integer
            example: 1
      responses:
        '200':
          description: Last moods for this user
          content:
            application/json:
              schema:
                type: object
                properties:
                  moods:
                    type: array
                    description: >
                      At most two items:
                      latest mood where user is receiver and latest where user is sender.
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                          example: 5
                        senderId:
                          type: integer
                          example: 1
                        receiverId:
                          type: integer
                          example: 2
                        moodId:
                          type: string
                          example: "2"
                        code:
                          type: string
                          example: "ABCD1234"
                        timestamp:
                          type: string
                          format: date-time
                          example: "2025-11-20T10:15:30.000Z"
        '400':
          description: Invalid id format
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Invalid id"
        '404':
          description: No moods found for this user
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "No moods found for this user"
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: "Internal server error"

  # Chat Controller

  /chat/getMessages/{code}:
    get:
      tags:
        - Chat Controller
      description: Get chats by code
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
          description: Chat code
      responses:
        "200":
          description: List of chats
          content:
            application/json:
              schema:
                type: array
        "404":
          description: No chats found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "500":
          description: Server error

  /chat/sendAttachment:
    post:
      tags:
        - Chat Controller
      description: Upload chat attachment
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
              required:
                - file
      responses:
        "200":
          description: Uploaded successfully
          content:
            application/json:
              schema:
                type: string
                description: Generated image name (S3 key)
        "404":
          description: No file uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        "500":
          description: Failed to upload image
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string